/**
 * Tuberculosis (TB) Disease Module
 * 
 * Based on WHO TB Treatment Guidelines (FREE, Public Domain)
 * Source: https://www.who.int/publications/i/item/9789240083851
 * 
 * Downloadable: 12KB
 * Offline-ready: 100% functional offline
 */

import { DiseaseModule } from './malaria';

export const tuberculosisModule: DiseaseModule = {
  id: 'tuberculosis',
  name: 'Tuberculosis (TB) Management',
  version: '1.0.0',
  size: '12KB',
  lastUpdated: '2025-11-27',
  
  icd10Codes: [
    {
      code: 'A15.0',
      title: 'Tuberculosis of lung, confirmed by sputum microscopy',
      description: 'Pulmonary TB with positive smear',
    },
    {
      code: 'A15.1',
      title: 'Tuberculosis of lung, confirmed by culture only',
      description: 'Pulmonary TB, culture positive but smear negative',
    },
    {
      code: 'A15.2',
      title: 'Tuberculosis of lung, confirmed histologically',
      description: 'Pulmonary TB confirmed by biopsy',
    },
    {
      code: 'A15.3',
      title: 'Tuberculosis of lung, confirmed by unspecified means',
      description: 'Confirmed pulmonary TB, method not specified',
    },
    {
      code: 'A15.6',
      title: 'Tuberculous pleurisy, confirmed bacteriologically',
      description: 'TB affecting pleura with bacteriological confirmation',
    },
    {
      code: 'A16.0',
      title: 'Tuberculosis of lung, bacteriologically and histologically negative',
      description: 'Clinical diagnosis of pulmonary TB',
    },
    {
      code: 'A16.2',
      title: 'Tuberculosis of lung, without mention of bacteriological or histological confirmation',
      description: 'Presumptive pulmonary TB',
    },
    {
      code: 'A17.0',
      title: 'Tuberculous meningitis',
      description: 'TB infection of meninges - EMERGENCY',
    },
    {
      code: 'A18.0',
      title: 'Tuberculosis of bones and joints',
      description: 'Extrapulmonary TB affecting skeletal system',
    },
    {
      code: 'A18.1',
      title: 'Tuberculosis of genitourinary system',
      description: 'Extrapulmonary TB of kidneys, bladder, reproductive organs',
    },
    {
      code: 'A19.0',
      title: 'Acute miliary tuberculosis of single site',
      description: 'Disseminated TB, single organ',
    },
    {
      code: 'A19.9',
      title: 'Miliary tuberculosis, unspecified',
      description: 'Disseminated TB, multiple organs',
    },
  ],

  diagnosticCriteria: [
    { symptom: 'Cough >2 weeks', severity: 'moderate', diagnostic: true },
    { symptom: 'Hemoptysis (coughing blood)', severity: 'severe', diagnostic: true },
    { symptom: 'Fever >2 weeks', severity: 'moderate', diagnostic: true },
    { symptom: 'Night sweats', severity: 'moderate', diagnostic: true },
    { symptom: 'Weight loss >5kg in 3 months', severity: 'moderate', diagnostic: true },
    { symptom: 'Loss of appetite', severity: 'mild', diagnostic: false },
    { symptom: 'Fatigue', severity: 'mild', diagnostic: false },
    { symptom: 'Chest pain', severity: 'moderate', diagnostic: false },
    { symptom: 'Positive sputum smear (AFB+)', severity: 'severe', diagnostic: true },
    { symptom: 'Positive GeneXpert MTB/RIF', severity: 'severe', diagnostic: true },
    { symptom: 'Positive tuberculin skin test (TST)', severity: 'moderate', diagnostic: false },
    { symptom: 'Chest X-ray: cavitary lesions', severity: 'severe', diagnostic: true },
  ],

  differentialDiagnosis: [
    'Pneumonia (J18)',
    'Lung cancer (C34)',
    'Chronic bronchitis (J42)',
    'Bronchiectasis (J47)',
    'Lung abscess (J85)',
    'Sarcoidosis (D86)',
    'Histoplasmosis (B39)',
    'HIV-related infections (B20)',
  ],

  treatmentGuidelines: {
    mild: [
      'âš ï¸ ALL TB requires treatment - "mild" = uncomplicated drug-sensitive TB',
      '',
      'ğŸ“‹ INTENSIVE PHASE (2 months):',
      '1. RHZE daily:',
      '   - Rifampicin (R): 10mg/kg (max 600mg)',
      '   - Isoniazid (H): 5mg/kg (max 300mg)',
      '   - Pyrazinamide (Z): 25mg/kg (max 2000mg)',
      '   - Ethambutol (E): 15mg/kg (max 1600mg)',
      '2. Fixed-dose combination (FDC) preferred',
      '3. Directly observed therapy (DOT) recommended',
      '',
      'ğŸ“‹ CONTINUATION PHASE (4 months):',
      '1. RH daily:',
      '   - Rifampicin: 10mg/kg',
      '   - Isoniazid: 5mg/kg',
      '2. Total treatment: 6 months',
      '3. DOT for at least intensive phase',
      '',
      'ğŸ’Š Adjunct therapy:',
      '- Pyridoxine (Vit B6): 25-50mg daily (prevent INH neuropathy)',
      '- If HIV+: Start ART within 8 weeks of TB treatment',
    ],
    moderate: [
      'âš ï¸ Same as mild BUT:',
      '',
      '1. Ensure DOT for ENTIRE treatment (6 months)',
      '2. If extrapulmonary TB:',
      '   - Lymph nodes, pleura: 6 months (same as pulmonary)',
      '   - Bones/joints: 9-12 months',
      '   - CNS (meningitis): 12 months + corticosteroids',
      '3. Monitor for complications:',
      '   - Sputum at month 2, 4, 6',
      '   - Weight monthly',
      '   - Liver function if symptomatic',
      '4. If drug resistance suspected:',
      '   - GeneXpert for rifampicin resistance',
      '   - Culture and sensitivity',
      '   - Consider adding fluoroquinolone',
      '5. Nutritional support',
      '6. Contact tracing and screening',
    ],
    severe: [
      'ğŸš¨ HOSPITAL ADMISSION REQUIRED',
      '',
      'Severe TB includes:',
      '- Tuberculous meningitis',
      '- Miliary (disseminated) TB',
      '- Severe pulmonary TB with respiratory failure',
      '- TB with complications (massive hemoptysis, pneumothorax)',
      '',
      '1. RHZE + Adjuvant therapy:',
      '   - TB meningitis: Add dexamethasone',
      '     * Adults: 12mg daily, taper over 6-8 weeks',
      '     * Children: 0.4mg/kg, taper over 6-8 weeks',
      '   - TB pericarditis: Add prednisolone',
      '     * 60mg daily, taper over 6-8 weeks',
      '',
      '2. Intensive monitoring:',
      '   - Daily vitals',
      '   - Neurological exam (if CNS TB)',
      '   - Sputum weekly until conversion',
      '   - Liver/renal function weekly',
      '',
      '3. Treat complications:',
      '   - Respiratory failure: Oxygen, possible ventilation',
      '   - Massive hemoptysis: Resuscitation, consider bronchial artery embolization',
      '   - Drug-induced hepatitis: Stop hepatotoxic drugs, support',
      '',
      '4. MDR-TB if suspected:',
      '   - GeneXpert MTB/RIF immediately',
      '   - Start empiric second-line treatment',
      '   - Consult TB specialist',
      '   - Treatment duration: 18-24 months',
      '',
      '5. HIV co-infection:',
      '   - Start ART within 2 weeks (TB meningitis)',
      '   - Within 8 weeks (other TB)',
      '   - Monitor for immune reconstitution syndrome (IRIS)',
    ],
  },

  redFlags: [
    'ğŸš¨ Hemoptysis (coughing blood) - risk of massive bleed',
    'ğŸš¨ Respiratory distress/hypoxia - ICU needed',
    'ğŸš¨ Altered consciousness - suspect TB meningitis',
    'ğŸš¨ Seizures - TB meningitis or drug toxicity',
    'ğŸš¨ Jaundice - drug-induced hepatitis, STOP hepatotoxic drugs',
    'ğŸš¨ Visual changes - ethambutol toxicity, STOP immediately',
    'ğŸš¨ Severe abdominal pain - consider GI TB or drug toxicity',
    'ğŸš¨ Drug resistance (failed treatment, previous TB)',
    'ğŸš¨ HIV co-infection - higher risk complications',
    'ğŸš¨ Diabetes - affects treatment response',
    'ğŸš¨ Pregnancy - teratogenic drugs, adjust regimen',
    'ğŸš¨ Children <5 years - higher risk severe disease',
    'ğŸš¨ MDR-TB contact - assume resistance until proven',
  ],

  followUp: [
    'Week 2: Check adherence, side effects, provide DOT support',
    'Month 2: Sputum smear/culture (should convert to negative)',
    'Month 3: Weight, adherence check',
    'Month 4: Sputum if symptomatic',
    'Month 5: Weight, adherence, prepare for completion',
    'Month 6: Final sputum, declare cured if negative',
    '',
    'Treatment outcomes:',
    'âœ“ Cured: Treatment completed + negative sputum',
    'âœ“ Treatment completed: Finished but no sputum available',
    'âš ï¸ Treatment failure: Still positive at month 5',
    'âš ï¸ Lost to follow-up: Missed >1 month consecutive doses',
    'âš ï¸ Died: Death during treatment',
    '',
    'If treatment failure:',
    '- GeneXpert for drug resistance',
    '- Culture and DST (drug sensitivity testing)',
    '- Refer to MDR-TB program',
    '',
    'Contact screening:',
    '- Household contacts: TB symptom screening',
    '- Children <5: Chest X-ray, TST/IGRA',
    '- HIV+ contacts: Screen and test',
  ],

  prevention: [
    'âœ“ BCG vaccination at birth (prevents severe childhood TB)',
    'âœ“ Contact screening and preventive therapy (TPT)',
    'âœ“ Infection control in healthcare:',
    '  - Administrative controls (triage, fast-track)',
    '  - Environmental controls (ventilation, UV light)',
    '  - Personal protective equipment (N95 masks)',
    'âœ“ Preventive therapy for high-risk:',
    '  - HIV+ persons: 6H or 3HP regimen',
    '  - Household contacts <5 years: 6H regimen',
    '  - Isoniazid (H): 5mg/kg daily x 6 months',
    '  - OR Rifapentine + Isoniazid (3HP): weekly x 3 months',
    'âœ“ Improve living conditions (reduce overcrowding)',
    'âœ“ Nutrition support for vulnerable populations',
    'âœ“ Early diagnosis and treatment (break transmission)',
    'âœ“ Active case finding in high-risk groups',
  ],
};

export default tuberculosisModule;
